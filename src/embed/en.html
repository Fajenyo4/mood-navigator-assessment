
<!DOCTYPE html>
<html>
<head>
  <title>English Assessment Embed</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    // Get the base URL from where this embed is being served
    const baseUrl = new URL(document.baseURI).origin;
    // Your application's actual domain
    const appDomain = "https://mood-navigator-assessment.lovable.app";
    
    // Function to create a direct access link
    function createDirectAccessLink(email, language = 'en') {
      // Create a simple token by encoding the email and timestamp
      const simpleToken = btoa(`${email}:${Date.now()}`);
      
      // Return the formatted URL
      return `${appDomain}/easy-access?token=${simpleToken}&email=${encodeURIComponent(email)}&lang=${language}`;
    }
    
    // Function to initiate quick access
    function quickAccess() {
      const testEmail = prompt("Enter email to access the English assessment:", "user@example.com");
      if (testEmail) {
        const accessLink = createDirectAccessLink(testEmail, 'en');
        window.location.href = accessLink;
      }
    }
    
    // Handle auth status messages from the embedded app
    window.addEventListener('message', function(event) {
      // Only process messages with auth status
      if (event.data && event.data.type === 'AUTH_STATUS') {
        console.log('Received auth status:', event.data);
        
        if (event.data.isAuthenticated === true) {
          console.log('User is authenticated, refreshing content');
          
          // Get the iframe and reload its content
          const iframe = document.getElementById('assessment');
          if (iframe) {
            // Force reload the iframe content to ensure proper state
            setTimeout(function() {
              iframe.src = iframe.src;
            }, 500);
          }
        }
      }
    });
  </script>
</head>
<body style="margin:0;padding:0;overflow:hidden;">
  <div style="position: relative;">
    <iframe 
      id="assessment"
      src="https://mood-navigator-assessment.lovable.app/login/en"
      width="100%" 
      height="800"
      frameborder="0"
      allow="fullscreen"
    ></iframe>
  </div>
  
  <!-- Add a message to confirm the embed is loading -->
  <script>
    console.log("English assessment embed loaded successfully");
    document.addEventListener('DOMContentLoaded', function() {
      // Add a small indicator that the embed is working
      const loadIndicator = document.createElement('div');
      loadIndicator.style.position = 'absolute';
      loadIndicator.style.bottom = '10px';
      loadIndicator.style.left = '10px';
      loadIndicator.style.padding = '5px 10px';
      loadIndicator.style.background = 'rgba(0,0,0,0.5)';
      loadIndicator.style.color = 'white';
      loadIndicator.style.borderRadius = '4px';
      loadIndicator.style.fontSize = '12px';
      loadIndicator.textContent = 'English Assessment Loaded';
      document.body.appendChild(loadIndicator);
      
      // Hide the indicator after 5 seconds
      setTimeout(() => {
        loadIndicator.style.opacity = '0';
        loadIndicator.style.transition = 'opacity 1s';
      }, 5000);
    });
  </script>
</body>
</html>
