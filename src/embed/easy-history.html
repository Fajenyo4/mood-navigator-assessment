
<!DOCTYPE html>
<html>
<head>
  <title>Mental Health History Chart</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    // Get the app domain from the current URL
    const appDomain = window.location.origin;
    
    // Function to create a direct access link with user parameters
    function createDirectAccessLink(language = 'en') {
      // Get email and name parameters if present
      const urlParams = new URLSearchParams(window.location.search);
      const email = urlParams.get('email');
      const name = urlParams.get('name');
      
      console.log("Parameters detected:", { email, name, language });
      
      // If we have email param, use SSO-like flow
      if (email && email !== "{{USER_EMAIL}}") {
        // Create a token that includes the email
        const userToken = btoa(`${email}:${Date.now()}`);
        
        // Return SSO-style URL with email and name
        return `${appDomain}/sso-login?token=${userToken}&email=${encodeURIComponent(email)}&name=${encodeURIComponent(name || email)}&lang=${language}&redirectUrl=${encodeURIComponent(appDomain + '/history-chart')}`;
      } else {
        // For public access, use a simpler token
        const simpleToken = btoa(`public:${Date.now()}`);
        
        // Return public access URL
        return `${appDomain}/easy-access?token=${simpleToken}&view=history&lang=${language}`;
      }
    }

    // Get language from URL parameter or default to English
    const urlParams = new URLSearchParams(window.location.search);
    const lang = urlParams.get('lang') || 'en';
    
    // Add detailed console logs for debugging
    console.log("Easy-history redirect starting");
    console.log("App domain:", appDomain);
    console.log("Language parameter:", lang);
    console.log("URL params:", Object.fromEntries(urlParams));
    console.log("Redirecting to:", createDirectAccessLink(lang));
    
    // Redirect immediately to appropriate access path
    window.location.href = createDirectAccessLink(lang);
  </script>
</head>
<body>
  <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh;">
    <img 
      src="/lovable-uploads/32730d45-90eb-4971-b489-51a01e471c37.png"
      alt="ICAN Live Well"
      style="width: 80px; height: 80px; margin-bottom: 20px;"
    />
    <p style="font-family: system-ui, -apple-system, sans-serif; color: #4b5563;">Redirecting to your assessment history...</p>
  </div>
</body>
</html>
