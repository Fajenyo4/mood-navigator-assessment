
<!DOCTYPE html>
<html>
<head>
  <title>English Assessment (SSO)</title>
  <script>
    // Get the base URL from where this embed is being served
    const baseUrl = new URL(document.baseURI).origin;
    // Your application's actual domain
    const appDomain = "https://mood-navigator-assessment.lovable.app";
    
    // This function would be called by LearnWorlds when a user is logged in
    function initSSO(userData) {
      console.log("SSO initiated with user data:", userData);
      
      // Example userData from LearnWorlds would include email and name
      const email = userData.email;
      const name = userData.name || 'Student';
      
      // Create a simple token by encoding the email and timestamp
      // In production, this should be replaced with a proper JWT from LearnWorlds
      const simpleToken = btoa(`${email}:${Date.now()}`);
      
      // Redirect to SSO login endpoint with token and language
      window.location.href = `${appDomain}/sso-login?token=${simpleToken}&email=${encodeURIComponent(email)}&name=${encodeURIComponent(name)}&lang=en`;
    }
    
    // Sample function to simulate LearnWorlds sending user data
    // This would typically be called by the LearnWorlds platform
    function simulateLearnWorldsLogin() {
      const testEmail = prompt("Enter test email for SSO login:", "student@example.com");
      if (testEmail) {
        initSSO({
          email: testEmail,
          name: "Test User"
        });
      }
    }
  </script>
</head>
<body style="margin:0;padding:0;overflow:hidden;">
  <div style="position: relative;">
    <iframe 
      id="assessment"
      src="https://mood-navigator-assessment.lovable.app/login/en"
      width="100%" 
      height="800"
      frameborder="0"
      allow="fullscreen"
    ></iframe>
    
    <!-- For testing purposes only - would be removed in production -->
    <button 
      onclick="simulateLearnWorldsLogin()" 
      style="position: absolute; top: 10px; right: 10px; z-index: 1000; background: #4f46e5; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;"
    >
      Test SSO Login
    </button>
  </div>
  
  <script>
    // Instructions for LearnWorlds integration
    console.log("LearnWorlds integration guide:");
    console.log("1. Add custom JavaScript in your LearnWorlds site that detects logged-in user");
    console.log("2. Call initSSO({email: 'user@example.com', name: 'User Name'}) when user clicks assessment link");
  </script>
</body>
</html>
